
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>&lt;no title&gt; &#8212; C-PAC 1.7.0 Beta documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../genindex" />
    <link rel="search" title="Search" href="../../search" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index">C-PAC 1.7.0 Beta documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">&lt;no title&gt;</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>Distortion correction is a method used for minimizing noise primarily in images obtained by echo-planar imaging (EPI). Using EPI, it has been possible to obtain individual MR slices in time frames of 50 - 100 ms, which minimizes losses in signal due to patient motion. However,EPI sequences have other sources of signal loss, primarily arising from tissue differences in the brain which result in static field inhomogenities {<a class="reference external" href="https://en.wikibooks.org/wiki/Neuroimaging_Data_Processing/Field_map_correction">https://en.wikibooks.org/wiki/Neuroimaging_Data_Processing/Field_map_correction</a>}
C-PAC provides options for configuring the Distortion correction workflow, either directly by manipulating the pipeline configuration, or by using the GUI. The EPI_DistCorr workflow is placed under the Functional Preprocessing tab. You can choose to run the workflow, and customize the parameters for the run. The field maps are generated within the distortion correction workflow, and sub sequentially sent to the “func_to_anat” non-linear registration for converting the input epi image into the structural phase.
FSL’s fieldmap correction takes in as it’s input a magnitude image, and a phase image which is obtained by phase subtraction between two magnitude images obtained in series. If the user has two input magnitude images, both should be inspected using fsleyes or afni to determine the image with “better quality” which can then be used.
The parameters provided in the GUI are described below:</p>
<ol class="arabic simple">
<li><p>Perform Field Map Distortion correction [switch]: “On” or “Off”. You can switch on or off the workflow as necessary</p></li>
</ol>
<p>2. Skull-strip the magnitude file with-[choice-box]: Since the output of the Distortion correction relies heavily on the skull strip, you could choose between AFNI-3d Skull-Strip and FSL-BET. The choice of tool to be used is currently only a feature for Distortion correction workflow. Both the workflows have identical options, thereby preventing any bias towards one tool.
3.BET threshold/AFNI shrink factor-[float]: The threshold for brain extraction. FSL requires tight skull-stripping, erring on the side of ignoring brain voxels rather than adding noise. However, it might not be required to increase the threshold in all datasets, so it is important to check your dataset before changing the threshold.In FSL-BET, this is referred to as “threshold intensity” and in AFNI’S 3dSkull Strip, it is the -shrink_facto. The default value is 0.5.
4. DeltaTE-[float,ms]: The time difference between the first magnitude image and the second magnitude image. The default value is 2.46 ms, which is widely used for SIEMENS, but it may differ with different datasets.
5.Dwell Time-[float,s]: The dwell time is also known as echo spacing, and it is the time between the start of the readout of two successive lines in k-space during the EPI acquisition. This is a value obtained from the functional epi (NOT the fieldmap)  Here, the default value is 0.0005s.
6. Dwell to asymmetric ratio-[float]: This is the ratio between the Dwell time, as referenced above and the asymmetric time. Here, the default value is 0.93902439.
7. Phase encoding direction-[string]: This is the position of the voxels in the input image, and can have values of x/y/z or -x/-y/-z. This is predominantly a trail and error based parameter.</p>
<p>Configuration without the GUI
The following key/value pairs must be defined in your pipeline configuration YAML for C-PAC to run Distortion correction</p>
<p>Key                                     Descripton                              Potential Values
Perform distortion                      Run Distortion                          A switch with [‘On’],
correction with field map               correction workflow                     [‘Off’] or [‘On’,’Off’]
correction</p>
<p>Skull-strip the magnitude               Use either FSL-BET                      A list to choose between
file                                    or AFNI-3dSkullStrip                    [‘FSL-BET’] and</p>
<blockquote>
<div><p>for the brain extraction                [3d-SkullStrip’]
of magnitude image.</p>
</div></blockquote>
<p>Brain Extraction Threshold              The ratio between
(or shrink factor in                     brain voxels to include                Float,default value is 0.5
AFNI-3dSkullStrip)                       and those to exclude(strip)</p>
<dl class="simple">
<dt>DeltaTE, ms                              The time delay between                 Float,default value is 2.46</dt><dd><p>first magnitude image and              for SIEMENS scanner.
second magnitude image.
The value is specific to each
session.This parameter is
used for preparing the
field map.</p>
</dd>
<dt>Dwell Time, s                            Also called the “echo spacing” Float,default value is</dt><dd><p>time, this is used as a parameter      0.0005
for FUGUE interface.</p>
</dd>
</dl>
<p>Dwell to asymmetric                      Ratio between the dwell time           Float,default value is
ratio                                    to the asymmetric time. This           0.93902439</p>
<blockquote>
<div><p>parameter is used for running
the EPI-registration</p>
</div></blockquote>
<p>Phase encoding                         Direction of unwrapping, the             (x/y/z or -x/-y/-z)
direction                                location of voxels in the input</p>
<blockquote>
<div><p>image</p>
</div></blockquote>
<p>The box below contains an example of what these parameters might look like when defined in the YAML:</p>
<p>runEPI_DistCorr                       :              [1]
fmap_distcorr_skullstrip                :               [BET]
fmap_distcorr_frac                    :                 [0.5]
fmap_distcorr_deltaTE                 :                 [2.46]
fmap_distcorr_dwell_time              :                 [0.0005]
fmap_distcorr_dwell_asym_ratio        :                 [0.93902439]
fmap_distcorr_pedir                     :               -y</p>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index">
              <img class="logo" src="../../_static/cpac_logo_vertical.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index">Table of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index">Welcome to CPAC’s developer documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index#indices-and-tables">Indices and tables</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index">C-PAC 1.7.0 Beta documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">&lt;no title&gt;</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, C-PAC Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19224662-10"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-19224662-10');
    </script>
    <script defer src="https://fcp-indi.github.io/scripts/versionList.js"></script>

  </body>
</html>